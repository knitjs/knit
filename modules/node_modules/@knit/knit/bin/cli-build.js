/* @flow */

const Listr = require('listr');

const errors = require('@knit/nice-errors');
const log = require('@knit/logger');
const tasks = require('@knit/common-tasks');

type TArgv = {
  scope: Array<string>,
  ignore: Array<string>,
  skip: boolean,
  force: boolean,
};

module.exports = (argv: TArgv) => {
  new Listr([
    ...tasks.modules,
    ...tasks.preflight.knit,
    ...tasks.packages,
    ...tasks.updated,
    ...require('../tasks/build'),
  ], {
    renderer: log.getRenderer(argv),
    collapse: false,
  }).run(argv).catch(errors.catchErrors);
};
