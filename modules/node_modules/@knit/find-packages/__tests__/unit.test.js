/* @flow */

import { findPackages, findPublicPackages } from '..';

const PATHS = {
  modules: '',
  modulesStub: '',
  data: '',
  dist: '',
  distStub: '',
  libStub: '',
  entry: '',
  entryStub: '',
  jsnextStub: '',
  umdStub: '',
  lib: '',
  jsnext: '',
  umd: '',
  rootDir: '',
  testsStub: '',
};


describe('findPackages', () => {
  it('returns list of modules from directories', () => {
    require('fs-extra').__setMockFiles({
      '': ['moduleA', 'moduleB'],
    });
    expect(findPackages(PATHS)).toEqual(['moduleA', 'moduleB']);
  });
  it('steps into @scoped directories', () => {
    require('fs-extra').__setMockFiles({
      '': ['moduleA', '@moduleB'],
      '@moduleB': ['moduleC'],
    });
    expect(findPackages(PATHS)).toEqual(['moduleA', '@moduleB/moduleC']);
  });
});

describe('findPublicPackages', () => {
  it('returns list of modules that have a package.json and have not set `private: true`', () => {
    require('fs-extra').__setMockFiles({
      '': ['moduleA', 'moduleB'],
    });
    require('read-pkg').__setMockPackages({
      moduleA: { name: 'moduleA' },
      moduleB: { name: 'moduleB', private: true },
    });
    expect(findPublicPackages(PATHS)).toEqual(['moduleA']);
  });
});
